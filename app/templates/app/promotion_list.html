{% extends 'app/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/css/promotion_list.css' %}">
{% endblock %}

{% block content_promotions %}
<div class="promotions-container">
    <div class="promotions-header">
        <h2 class="promotions-title">SƒÉn Deal H·ªùi - ƒê·ªùi L√™n H∆∞∆°ng üì±</h2>
        <p class="promotions-subtitle">T·ªïng h·ª£p m√£ gi·∫£m gi√° ƒë·ªôc quy·ªÅn d√†nh ri√™ng cho b·∫°n</p>
    </div>

    <div class="promo-filter-tags">
        <span class="filter-tag active">T·∫•t c·∫£</span>
        <span class="filter-tag">Kh√°ch m·ªõi</span>
        <span class="filter-tag">VIP</span>
    </div>

    <div class="row">
        {% for promo in promotions %}
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="promo-card type-{{ promo.promotion_type }}">

                {% if promo.promotion_type == 'new_user' or promo.promotion_type == 'new customer' %}
                <div class="promo-badge badge-new-user">üëã New Member</div>
                {% elif promo.promotion_type == 'vip' %}
                <div class="promo-badge badge-vip">üíé VIP Only</div>
                {% elif promo.promotion_type == 'holiday' %}
                <div class="promo-badge badge-holiday">üéâ Holiday</div>
                {% elif promo.promotion_type == 'new_arrival' %}
                <div class="promo-badge badge-new">üî• Hot New</div>
                {% elif promo.promotion_type == 'flash_sale' %}
                <div class="promo-badge badge-danger">‚ö° Flash Sale</div>
                {% endif %}

                <div class="promo-header {% if promo.is_percentage %}promo-header-percentage{% else %}promo-header-fixed{% endif %}">
                    <div class="discount-wrapper">
                        <span class="discount-label">Gi·∫£m t·ªõi</span>
                        <h3 class="promo-discount">
                            {% if promo.is_percentage %}
                            {{ promo.discount_value|floatformat:0 }}%
                            {% else %}
                            {{ promo.discount_value|floatformat:0 }}ƒë
                            {% endif %}
                        </h3>
                    </div>
                    <div class="event-tag">{{ promo.event_name }}</div>
                </div>

                <div class="promo-body">
                    <div class="promo-code-display">
                        <code>{{ promo.code }}</code>
                    </div>

                    <p class="promo-description">{{ promo.description }}</p>

                    <div class="promo-meta">

                        {% if promo.target_brands.exists %}
                        <div class="meta-item">
                            <span class="icon">üè∑Ô∏è</span>
                            <span class="meta-label">H√£ng:</span>
                            <span class="meta-value">
                                {% for brand in promo.target_brands.all %}
                                    {{ brand.name }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </span>
                        </div>
                        {% endif %}

                        {% if promo.target_products.exists %}
                        <div class="meta-item">
                            <span class="icon">üì±</span>
                            <span class="meta-label">S·∫£n ph·∫©m:</span>
                            <span class="meta-value">
                                {% for product in promo.target_products.all|slice:":3" %}
                                    {{ product.name }}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                                {% if promo.target_products.count > 3 %}...{% endif %}
                            </span>
                        </div>
                        {% endif %}

                        {% if promo.target_customer_types.exists %}
                        <div class="meta-item">
                            <span class="icon">üëë</span>
                            <span class="meta-label">D√†nh cho:</span>
                            <div class="group-tags">
                                {% for type in promo.target_customer_types.all %}
                                <span class="badge-group">{{ type.name }}</span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}

                        <div class="meta-item">
                            <span class="icon">‚è≥</span>
                            <span class="meta-label">HSD:</span>
                            <span class="meta-value text-danger">
                                {{ promo.end_date|date:"d/m/Y" }}
                            </span>
                        </div>
                    </div> </div>

                <div class="promo-footer">
                    <button onclick="copyPromoCode(this, '{{ promo.code }}')" class="btn-copy-code">
                        <span class="btn-text">Sao ch√©p m√£</span>
                        <span class="btn-icon">üìã</span>
                    </button>
                    <a href="{% url 'home' %}" class="btn-use-now">D√πng ngay</a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="promo-empty-state">
                <img src="{% static 'app/images/empty-promo.png' %}" alt="No Promo" style="max-width: 150px; opacity: 0.5;">
                <p>Ti·∫øc qu√°! Hi·ªán ch∆∞a c√≥ m√£ gi·∫£m gi√° n√†o ph√π h·ª£p.</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    function copyPromoCode(btn, code) {
        navigator.clipboard.writeText(code).then(function() {
            let originalText = btn.innerHTML;
            btn.innerHTML = "<span class='btn-text'>ƒê√£ sao ch√©p!</span> <span class='btn-icon'>‚úÖ</span>";
            btn.classList.add('copied');

            setTimeout(() => {
                btn.innerHTML = originalText;
                btn.classList.remove('copied');
            }, 2000);
        }).catch(function(err) {
            console.error('L·ªói sao ch√©p', err);
        });
    }
</script>
{% endblock %}
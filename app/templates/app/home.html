{% extends 'app/base.html' %} 
{% load static %}
{% load humanize %} 

{% block extra_css %}
<style>
    /* CSS cho card sản phẩm */
    .product-card {
        transition: transform 0.3s, box-shadow 0.3s;
        border-radius: 12px;
        overflow: hidden;
    }
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    .product-card img {
        height: 200px; /* Chiều cao cố định cho ảnh sản phẩm */
        object-fit: contain;
        padding: 15px;
        background-color: #f7f7f7;
    }
    .product-card .card-body {
        padding: 15px;
    }
    .product-card .product-name {
        min-height: 40px; /* Giữ cho tên sản phẩm không bị xô lệch */
    }
    .product-price {
        font-size: 1.25rem;
        color: #dc3545;
        font-weight: bold;
    }

    /* CSS cho Brand List (Hãng sản xuất) */
    .brand-list-container {
        padding: 20px 0;
        background-color: #f8f9fa;
        border-radius: 12px;
        margin-bottom: 40px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }
    .brand-card {
        display: block;
        transition: all 0.2s;
        max-width: 100px;
    }
    .brand-image-wrapper {
        width: 70px;
        height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        background-color: #ffffff;
        border: 2px solid transparent !important;
    }
    .brand-logo {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
    .brand-card:hover {
        transform: scale(1.05);
    }
    .brand-card:hover .brand-image-wrapper {
        border-color: #007bff !important;
        box-shadow: 0 0 10px rgba(0, 123, 255, 0.3);
    }
    .brand-card p {
        font-size: 0.85rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
</style>
{% endblock extra_css %}

{% block banner_slider %}
<div id="carouselExampleDark" class="carousel carousel-dark slide" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleDark" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active" data-bs-interval="10000">
      <img src="{% static 'app/images/banner/b1.jpg' %}" class="d-block w-100" alt="Banner 1" style="height: 400px; object-fit: cover;">
      <div class="carousel-caption d-none d-md-block bg-success text-white opacity-75 rounded p-2">
        <h5>First slide label</h5>
        <p>Some representative placeholder content for the first slide.</p>
      </div>
    </div>
    <div class="carousel-item" data-bs-interval="2000">
      <img src="{% static 'app/images/banner/b2.jpg' %}" class="d-block w-100" alt="Banner 2" style="height: 400px; object-fit: cover;">
      <div class="carousel-caption d-none d-md-block bg-success text-white opacity-75 rounded p-2">
        <h5>Second slide label</h5>
        <p>Some representative placeholder content for the second slide.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="{% static 'app/images/banner/b3.jpg' %}" class="d-block w-100" alt="Banner 3" style="height: 400px; object-fit: cover;">
      <div class="carousel-caption d-none d-md-block bg-success text-white opacity-75 rounded p-2">
        <h5>Third slide label</h5>
        <p>Some representative placeholder content for the third slide.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleDark" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>
{% endblock banner_slider %}

{% block main_content %} 
<div class="container my-5">
    
    <!-- --------------------------------------- -->
    <!-- PHẦN 1: Danh sách Hãng Điện Thoại (MỚI) -->
    <!-- --------------------------------------- -->
    <h3 class="fw-bold text-center mb-4">Khám phá theo Hãng Sản Xuất</h3>
    
    <div class="brand-list-container d-flex flex-wrap justify-content-center p-3 mb-5">
{% for brand in brands %}
    <a href="{% url 'product_list_by_brand' brand.slug %}" class="brand-card text-center text-decoration-none mx-2 my-2">
        <div class="brand-image-wrapper rounded-circle shadow-sm">
            <!-- Sửa: Thêm kiểm tra điều kiện brand.image -->
            {% if brand.image %}
                <!-- Sử dụng brand.image.url nếu có ảnh -->
                <img src="{{ brand.image.url }}" alt="{{ brand.name }}" class="brand-logo rounded-circle">
            {% else %}
                <!-- Hiển thị placeholder hoặc icon nếu không có ảnh -->
                <div class="p-3 text-center text-muted">No Image</div>
            {% endif %}
        </div>
        <p class="small fw-bold mt-2 text-dark">{{ brand.name }}</p>
    </a>
{% empty %}
        <p class="text-muted">Không có hãng sản xuất nào được tìm thấy.</p>
        {% endfor %}
    </div>

    <hr class="my-5">

    <!-- --------------------------------------- -->
    <!-- PHẦN 2: Danh sách Sản Phẩm Nổi Bật -->
    <!-- --------------------------------------- -->
    <h3 class="fw-bold mb-4">Sản Phẩm Nổi Bật</h3>
    
    <div class="row"> 
        {% for product in products %}
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card product-card h-100 shadow-sm border-0">
                
                <!-- Hình ảnh sản phẩm -->
                <img class="card-img-top" src="{{ product.ImageURL }}" alt="{{ product.name }}"/>
                
                <div class="card-body d-flex flex-column">
                    <!-- Tên sản phẩm -->
                    <h6 class="card-title product-name fw-bold mb-3">
                        {{ product.name }}
                    </h6>

                    <!-- Giá sản phẩm -->
                    <h3 class="product-price mt-auto mb-3">
                        {{ product.price | floatformat:0 | intcomma }}₫
                    </h3>
                    
                    <div class="d-grid gap-2">
                        <!-- Nút Thêm giỏ hàng (AJAX) -->
                        <button data-product="{{product.id}}" 
                                data-action="add" 
                                class="btn btn-danger update-cart">
                                Thêm vào giỏ hàng
                        </button>
                        <!-- Nút Xem chi tiết -->
                        <a class="btn btn-outline-secondary" href="{% url 'product_detail' product.id %}">
                            Xem chi tiết
                        </a> 
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock main_content %}
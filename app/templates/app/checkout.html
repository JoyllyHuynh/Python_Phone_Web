{% extends 'app/base.html' %}
{% load static %}

{% block title %}Thanh to√°n{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app/css/checkout.css' %}">
{% endblock %}

{% block content_checkout %}
<div class="checkout-container">

    <!-- Checkout Header -->
    <div class="checkout-header">
        <div class="checkout-header-content">
            <a href="{% url 'cart' %}" class="btn-back">
                <span class="back-icon">‚Üê</span>
                <span>Quay l·∫°i gi·ªè h√†ng</span>
            </a>
            <h1 class="checkout-title">Thanh to√°n ƒë∆°n h√†ng</h1>
            <p class="checkout-subtitle">Ho√†n t·∫•t th√¥ng tin ƒë·ªÉ ƒë·∫∑t h√†ng</p>
        </div>

        <!-- Checkout Steps -->
        <div class="checkout-steps">
            <div class="step completed">
                <div class="step-number">1</div>
                <div class="step-label">Gi·ªè h√†ng</div>
            </div>
            <div class="step-line completed"></div>
            <div class="step active">
                <div class="step-number">2</div>
                <div class="step-label">Thanh to√°n</div>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <div class="step-number">3</div>
                <div class="step-label">Ho√†n t·∫•t</div>
            </div>
        </div>
    </div>

    <!-- Main Checkout Content -->
    <div class="checkout-content">
        <div class="row">

            <!-- Left Column - Forms -->
            <div class="col-lg-7">
                <form id="checkoutForm" method="POST" class="checkout-form">
                    {% csrf_token %}

                    <!-- Customer Information -->
                    <div class="checkout-section" id="customer-info">
                        <div class="section-header">
                            <div class="section-icon">üë§</div>
                            <div class="section-title-wrapper">
                                <h3 class="section-title">Th√¥ng tin kh√°ch h√†ng</h3>
                                <p class="section-desc">Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin</p>
                            </div>
                        </div>

                        <div class="section-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">
                                        H·ªç v√† t√™n <span class="required">*</span>
                                    </label>
                                    <input type="text"
                                           name="name"
                                           class="form-input"
                                           placeholder="Nguy·ªÖn VƒÉn A"
                                           required
                                           {% if user.is_authenticated %}
                                           value="{{ user.get_full_name }}"
                                           {% endif %}>
                                </div>
                            </div>

                            <div class="form-row two-columns">
                                <div class="form-group">
                                    <label class="form-label">
                                        Email <span class="required">*</span>
                                    </label>
                                    <input type="email"
                                           name="email"
                                           class="form-input"
                                           placeholder="email@example.com"
                                           required
                                           {% if user.is_authenticated %}
                                           value="{{ user.email }}"
                                           {% endif %}>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        S·ªë ƒëi·ªán tho·∫°i <span class="required">*</span>
                                    </label>
                                    <input type="tel"
                                           name="phone"
                                           class="form-input"
                                           placeholder="0912 345 678"
                                           required
                                           pattern="[0-9]{10,11}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shipping Information -->
                    <div class="checkout-section" id="shipping-info">
                        <div class="section-header">
                            <div class="section-icon">üì¶</div>
                            <div class="section-title-wrapper">
                                <h3 class="section-title">Th√¥ng tin giao h√†ng</h3>
                                <p class="section-desc">ƒê·ªãa ch·ªâ nh·∫≠n h√†ng c·ªßa b·∫°n</p>
                            </div>
                        </div>

                        <div class="section-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">
                                        ƒê·ªãa ch·ªâ <span class="required">*</span>
                                    </label>
                                    <input type="text"
                                           name="address"
                                           class="form-input"
                                           placeholder="S·ªë nh√†, t√™n ƒë∆∞·ªùng, ph∆∞·ªùng/x√£"
                                           required>
                                </div>
                            </div>

                            <div class="form-row two-columns">
                                <div class="form-group">
                                    <label class="form-label">
                                        T·ªânh/Th√†nh ph·ªë <span class="required">*</span>
                                    </label>
                                    <select name="city" class="form-input form-select" required>
                                        <option value="">Ch·ªçn T·ªânh/Th√†nh ph·ªë</option>
                                        <option value="hanoi">H√† N·ªôi</option>
                                        <option value="hcm">TP. H·ªì Ch√≠ Minh</option>
                                        <option value="danang">ƒê√† N·∫µng</option>
                                        <option value="haiphong">H·∫£i Ph√≤ng</option>
                                        <option value="cantho">C·∫ßn Th∆°</option>
                                        <option value="other">T·ªânh/Th√†nh ph·ªë kh√°c</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        Qu·∫≠n/Huy·ªán <span class="required">*</span>
                                    </label>
                                    <select name="district" class="form-input form-select" required>
                                        <option value="">Ch·ªçn Qu·∫≠n/Huy·ªán</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row two-columns">
                                <div class="form-group">
                                    <label class="form-label">
                                        Ph∆∞·ªùng/X√£ <span class="required">*</span>
                                    </label>
                                    <select name="ward" class="form-input form-select" required>
                                        <option value="">Ch·ªçn Ph∆∞·ªùng/X√£</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">M√£ b∆∞u ƒëi·ªán</label>
                                    <input type="text"
                                           name="zipcode"
                                           class="form-input"
                                           placeholder="100000">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Ghi ch√∫ ƒë∆°n h√†ng</label>
                                    <textarea name="note"
                                              class="form-input form-textarea"
                                              rows="3"
                                              placeholder="Ghi ch√∫ v·ªÅ ƒë∆°n h√†ng, v√≠ d·ª•: th·ªùi gian hay ƒë·ªãa ƒëi·ªÉm giao h√†ng chi ti·∫øt h∆°n."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Shipping Method -->
                    <div class="checkout-section" id="shipping-method">
                        <div class="section-header">
                            <div class="section-icon">üöö</div>
                            <div class="section-title-wrapper">
                                <h3 class="section-title">Ph∆∞∆°ng th·ª©c v·∫≠n chuy·ªÉn</h3>
                                <p class="section-desc">Ch·ªçn h√¨nh th·ª©c giao h√†ng</p>
                            </div>
                        </div>

                        <div class="section-body">
                            <div class="shipping-options">
                                <label class="shipping-option selected">
                                    <input type="radio" name="shipping_method" value="standard" checked>
                                    <div class="option-content">
                                        <div class="option-icon">üì¶</div>
                                        <div class="option-details">
                                            <span class="option-name">Giao h√†ng ti√™u chu·∫©n</span>
                                            <span class="option-time">3-5 ng√†y l√†m vi·ªác</span>
                                        </div>
                                        <div class="option-price">
                                            <span class="price-value">30.000‚Ç´</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="shipping-option">
                                    <input type="radio" name="shipping_method" value="express">
                                    <div class="option-content">
                                        <div class="option-icon">‚ö°</div>
                                        <div class="option-details">
                                            <span class="option-name">Giao h√†ng nhanh</span>
                                            <span class="option-time">1-2 ng√†y l√†m vi·ªác</span>
                                        </div>
                                        <div class="option-price">
                                            <span class="price-value">50.000‚Ç´</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="shipping-option">
                                    <input type="radio" name="shipping_method" value="same_day">
                                    <div class="option-content">
                                        <div class="option-icon">üèÉ</div>
                                        <div class="option-details">
                                            <span class="option-name">Giao h√†ng trong ng√†y</span>
                                            <span class="option-time">Nh·∫≠n h√†ng trong 2-4 gi·ªù</span>
                                            <span class="option-badge">Ch·ªâ HN & HCM</span>
                                        </div>
                                        <div class="option-price">
                                            <span class="price-value">80.000‚Ç´</span>
                                        </div>
                                    </div>
                                </label>

                                <label class="shipping-option free-shipping {% if order.get_cart_total >= 5000000 %}available{% endif %}">
                                    <input type="radio" name="shipping_method" value="free">
                                    <div class="option-content">
                                        <div class="option-icon">üéÅ</div>
                                        <div class="option-details">
                                            <span class="option-name">Mi·ªÖn ph√≠ v·∫≠n chuy·ªÉn</span>
                                            <span class="option-time">3-5 ng√†y l√†m vi·ªác</span>
                                            {% if order.get_cart_total < 5000000 %}
                                            <span class="option-note">ƒê∆°n h√†ng t·ª´ 5.000.000‚Ç´</span>
                                            {% endif %}
                                        </div>
                                        <div class="option-price">
                                            <span class="price-value free">MI·ªÑN PH√ç</span>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Method -->
                    <div class="checkout-section" id="payment-method">
                        <div class="section-header">
                            <div class="section-icon">üí≥</div>
                            <div class="section-title-wrapper">
                                <h3 class="section-title">Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
                                <p class="section-desc">Ch·ªçn c√°ch thanh to√°n ph√π h·ª£p</p>
                            </div>
                        </div>

                        <div class="section-body">
                            <div class="payment-options">

                                <!-- COD -->
                                <label class="payment-option selected">
                                    <input type="radio" name="payment_method" value="cod" checked>
                                    <div class="option-content">
                                        <div class="option-icon-wrapper cod">
                                            <img src="{% static 'images/cod.png' %}" alt="COD">
                                        </div>
                                        <div class="option-details">
                                            <span class="option-name">Thanh to√°n khi nh·∫≠n h√†ng (COD)</span>
                                            <span class="option-desc">Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t khi nh·∫≠n h√†ng</span>
                                        </div>
                                        <div class="option-check">‚úì</div>
                                    </div>
                                </label>

                                <!-- Bank Transfer -->
                                <label class="payment-option">
                                    <input type="radio" name="payment_method" value="bank_transfer">
                                    <div class="option-content">
                                        <div class="option-icon-wrapper bank">
                                            <img src="{% static 'images/chuyenkhoan.webp' %}" alt="Bank">
                                        </div>
                                        <div class="option-details">
                                            <span class="option-name">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</span>
                                            <span class="option-desc">Chuy·ªÉn kho·∫£n tr∆∞·ªõc khi giao h√†ng</span>
                                        </div>
                                        <div class="option-check">‚úì</div>
                                    </div>
                                </label>

                                <!-- VNPay -->
                                <label class="payment-option">
                                    <input type="radio" name="payment_method" value="vnpay">
                                    <div class="option-content">
                                        <div class="option-icon-wrapper vnpay">
                                            <img src="https://vinadesign.vn/uploads/images/2023/05/vnpay-logo-vinadesign-25-12-57-55.jpg" alt="VNPay">
                                        </div>
                                        <div class="option-details">
                                            <span class="option-name">V√≠ VNPay</span>
                                            <span class="option-desc">Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠ VNPay</span>
                                        </div>
                                        <div class="option-check">‚úì</div>
                                    </div>
                                </label>

                                <!-- MoMo -->
                                <label class="payment-option">
                                    <input type="radio" name="payment_method" value="momo">
                                    <div class="option-content">
                                        <div class="option-icon-wrapper momo">
                                            <img src="{% static 'images/Logo-MoMo.webp' %}" alt="MoMo">
                                        </div>
                                        <div class="option-details">
                                            <span class="option-name">V√≠ MoMo</span>
                                            <span class="option-desc">Thanh to√°n qua v√≠ ƒëi·ªán t·ª≠ MoMo</span>
                                        </div>
                                        <div class="option-check">‚úì</div>
                                    </div>
                                </label>

                                <!-- Credit Card -->
                                <label class="payment-option">
                                    <input type="radio" name="payment_method" value="credit_card">
                                    <div class="option-content">
                                        <div class="option-icon-wrapper card">
                                            <img src="{% static 'images/thetindung.jpg' %}" alt="Mastercard">
                                        </div>
                                        <div class="option-details">
                                            <span class="option-name">Th·∫ª t√≠n d·ª•ng / Ghi n·ª£</span>
                                            <span class="option-desc">Visa, Mastercard, JCB</span>
                                        </div>
                                        <div class="option-check">‚úì</div>
                                    </div>
                                </label>

                                <!-- Installment -->
                                <label class="payment-option installment">
                                    <input type="radio" name="payment_method" value="installment">
                                    <div class="option-content">
                                        <div class="option-icon-wrapper">
                                            <span class="installment-icon">üìä</span>
                                        </div>
                                        <div class="option-details">
                                            <span class="option-name">Tr·∫£ g√≥p 0%</span>
                                            <span class="option-desc">Tr·∫£ g√≥p qua th·∫ª t√≠n d·ª•ng ho·∫∑c c√¥ng ty t√†i ch√≠nh</span>
                                            <span class="option-badge hot">HOT</span>
                                        </div>
                                        <div class="option-check">‚úì</div>
                                    </div>
                                </label>
                            </div>

                            <!-- Bank Transfer Info (Hidden by default) -->
                            <div class="payment-details hidden" id="bank-transfer-info">
                                <div class="bank-info-card">
                                    <h4>Th√¥ng tin chuy·ªÉn kho·∫£n</h4>
                                    <div class="bank-details">
                                        <p><strong>Ng√¢n h√†ng:</strong> Vietcombank</p>
                                        <p><strong>S·ªë t√†i kho·∫£n:</strong> 1234567890</p>
                                        <p><strong>Ch·ªß t√†i kho·∫£n:</strong> CONG TY PHONE STORE</p>
                                        <p><strong>N·ªôi dung CK:</strong> <span class="order-code">PS-{{ order.id }}</span></p>
                                    </div>
                                    <div class="qr-code">
                                        <img src="{% static 'app/images/qr-bank.png' %}" alt="QR Code">
                                        <span>Qu√©t m√£ QR ƒë·ªÉ chuy·ªÉn kho·∫£n</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Credit Card Form (Hidden by default) -->
                            <div class="payment-details hidden" id="credit-card-form">
                                <div class="card-form">
                                    <div class="form-group">
                                        <label class="form-label">S·ªë th·∫ª</label>
                                        <input type="text"
                                               class="form-input"
                                               placeholder="1234 5678 9012 3456"
                                               maxlength="19">
                                    </div>
                                    <div class="form-row two-columns">
                                        <div class="form-group">
                                            <label class="form-label">Ng√†y h·∫øt h·∫°n</label>
                                            <input type="text"
                                                   class="form-input"
                                                   placeholder="MM/YY"
                                                   maxlength="5">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">CVV</label>
                                            <input type="text"
                                                   class="form-input"
                                                   placeholder="123"
                                                   maxlength="4">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">T√™n tr√™n th·∫ª</label>
                                        <input type="text"
                                               class="form-input"
                                               placeholder="NGUYEN VAN A">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Voucher Code -->
                    <div class="checkout-section" id="voucher-section">
                        <div class="section-header">
                            <div class="section-icon">üé´</div>
                            <div class="section-title-wrapper">
                                <h3 class="section-title">M√£ gi·∫£m gi√°</h3>
                                <p class="section-desc">Nh·∫≠p m√£ ƒë·ªÉ ƒë∆∞·ª£c gi·∫£m gi√°</p>
                            </div>
                        </div>

                        <div class="section-body">
                            <div class="voucher-input-wrapper">
                                <input type="text"
                                       name="voucher_code"
                                       class="form-input voucher-input"
                                       placeholder="Nh·∫≠p m√£ gi·∫£m gi√°">
                                <button type="button" class="btn-apply-voucher" id="applyVoucher">
                                    √Åp d·ª•ng
                                </button>
                            </div>
                            <div class="voucher-message hidden" id="voucherMessage"></div>

                            <!-- Available Vouchers -->
                            <div class="available-vouchers">
                                <p class="vouchers-title">M√£ gi·∫£m gi√° c√≥ s·∫µn:</p>
                                <div class="voucher-tags">
                                    <span class="voucher-tag" data-code="NEWUSER">NEWUSER - Gi·∫£m 10%</span>
                                    <span class="voucher-tag" data-code="FREESHIP">FREESHIP - Free ship</span>
                                    <span class="voucher-tag" data-code="SUMMER50">SUMMER50 - Gi·∫£m 50K</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </form>
            </div>

            <!-- Right Column - Order Summary -->
            <div class="col-lg-5">
                <div class="order-summary-wrapper">

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <div class="summary-header">
                            <h3 class="summary-title">ƒê∆°n h√†ng c·ªßa b·∫°n</h3>
                            <span class="item-count">{{ order.get_cart_items }} s·∫£n ph·∫©m</span>
                        </div>

                        <!-- Order Items -->
                        <div class="order-items">
                            {% for item in items %}
                            <div class="order-item">
                                <div class="item-image">
                                    <img src="{{ item.product.ImageURL }}" alt="{{ item.product.name }}">
                                    <span class="item-quantity">{{ item.quantity }}</span>
                                </div>
                                <div class="item-details">
                                    <h4 class="item-name">{{ item.product.name }}</h4>
                                    <p class="item-variant">
                                        {% if item.product.color %}M√†u: {{ item.product.color }}{% endif %}
                                        {% if item.product.storage %} | {{ item.product.storage }}{% endif %}
                                    </p>
                                </div>
                                <div class="item-price">
                                    <span class="price-current">{{ item.get_total|floatformat:0 }}‚Ç´</span>
                                    {% if item.product.original_price %}
                                    <span class="price-original">{{ item.product.original_price|floatformat:0 }}‚Ç´</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% empty %}
                            <div class="empty-cart-message">
                                <p>Gi·ªè h√†ng tr·ªëng</p>
                                <a href="{% url 'home' %}">Ti·∫øp t·ª•c mua s·∫Øm</a>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Order Totals -->
                        <div class="order-totals">
                            <div class="total-row">
                                <span class="total-label">T·∫°m t√≠nh</span>
                                <span class="total-value">{{ order.get_cart_total|floatformat:0 }}‚Ç´</span>
                            </div>
                            <div class="total-row">
                                <span class="total-label">Ph√≠ v·∫≠n chuy·ªÉn</span>
                                <span class="total-value shipping-fee">30.000‚Ç´</span>
                            </div>
                            <div class="total-row discount hidden" id="discountRow">
                                <span class="total-label">Gi·∫£m gi√°</span>
                                <span class="total-value discount-value">-0‚Ç´</span>
                            </div>
                            <div class="total-row grand-total">
                                <span class="total-label">T·ªïng c·ªông</span>
                                <span class="total-value grand-total-value">
                                    {{ order.get_cart_total|floatformat:0 }}‚Ç´
                                </span>
                            </div>
                            <p class="vat-note">(ƒê√£ bao g·ªìm VAT n·∫øu c√≥)</p>
                        </div>
                    </div>

                    <!-- Promotions -->
                    <div class="promotions-box">
                        <div class="promo-item">
                            <span class="promo-icon">üéÅ</span>
                            <span class="promo-text">T·∫∑ng k√®m ·ªëp l∆∞ng + c∆∞·ªùng l·ª±c tr·ªã gi√° 500.000‚Ç´</span>
                        </div>
                        <div class="promo-item">
                            <span class="promo-icon">üîÑ</span>
                            <span class="promo-text">ƒê·ªïi tr·∫£ mi·ªÖn ph√≠ trong 30 ng√†y</span>
                        </div>
                        <div class="promo-item">
                            <span class="promo-icon">üõ°Ô∏è</span>
                            <span class="promo-text">B·∫£o h√†nh ch√≠nh h√£ng 12 th√°ng</span>
                        </div>
                    </div>

                    <!-- Place Order Button -->
                    <button type="submit" form="checkoutForm" class="btn-place-order" id="placeOrderBtn">
                        <span class="btn-icon">üîí</span>
                        <span class="btn-text">ƒê·∫∑t h√†ng</span>
                        <span class="btn-price">{{ order.get_cart_total|floatformat:0 }}‚Ç´</span>
                    </button>

                    <!-- Terms -->
                    <p class="terms-note">
                        B·∫±ng vi·ªác ƒë·∫∑t h√†ng, b·∫°n ƒë·ªìng √Ω v·ªõi
                        <a href="#">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</a> v√†
                        <a href="#">Ch√≠nh s√°ch b·∫£o m·∫≠t</a> c·ªßa Neel
                    </p>




                </div>
            </div>

        </div>
    </div>

</div>

<!-- Order Confirmation Modal -->
<div class="modal-overlay hidden" id="confirmModal">
    <div class="modal-content">
        <div class="modal-icon success">‚úì</div>
        <h2 class="modal-title">X√°c nh·∫≠n ƒë∆°n h√†ng</h2>
        <p class="modal-message">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒë·∫∑t ƒë∆°n h√†ng n√†y?</p>
        <div class="modal-details">
            <p><strong>T·ªïng ti·ªÅn:</strong> <span id="modalTotal">0‚Ç´</span></p>
            <p><strong>Ph∆∞∆°ng th·ª©c:</strong> <span id="modalPayment">COD</span></p>
        </div>
        <div class="modal-actions">
            <button class="btn-modal-cancel" id="cancelOrder">H·ªßy</button>
            <button class="btn-modal-confirm" id="confirmOrder">X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'app/js/checkout.js' %}"></script>
{% endblock %}